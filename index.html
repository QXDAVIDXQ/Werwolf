<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üê∫ Werw√∂lfe von D√ºsterwald ‚Äì Vollversion</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 900px; margin: 0 auto; padding: 15px;
      background: #fdf9f0; color: #333;
    }
    .section {
      background: white; padding: 16px; margin: 16px 0;
      border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    h1, h2, h3 { color: #5d4037; }
    input, button, select {
      padding: 9px; margin: 6px; font-size: 15px;
      border: 1px solid #ccc; border-radius: 6px;
    }
    button {
      background: #388e3c; color: white; border: none;
      cursor: pointer; font-weight: bold;
    }
    button:hover:not(:disabled) { background: #2e7d32; }
    button:disabled {
      background: #bdbdbd; cursor: not-allowed;
    }
    button.danger { background: #d32f2f; }
    .rolle-btn {
      display: inline-block; margin: 5px; padding: 10px;
      background: #f1f8e9; border: 1px solid #8bc34a;
      border-radius: 6px; cursor: pointer; min-width: 180px;
    }
    .rolle-btn.active { background: #dcedc8; font-weight: bold; }
    .phase { display: none; }
    .phase.active { display: block; }
    .spieler-item { margin: 4px 0; }
    .hidden { display: none; }
    .info { background: #e3f2fd; padding: 10px; border-radius: 6px; margin: 10px 0; }
  </style>
</head>
<body>

<h1>üê∫ Werw√∂lfe von D√ºsterwald</h1>

<!-- SETUP -->
<div id="phase-setup" class="phase active">
  <div class="section">
    <h2>1. Spielerzahl (6‚Äì48)</h2>
    <input type="number" id="spielerzahl" min="6" max="48" value="8" />
  </div>

  <div class="section">
    <h2>2. Namen eingeben</h2>
    <div id="namen-liste"></div>
  </div>

  <div class="section">
    <h2>3. Rollen ausw√§hlen</h2>
    <p>Gesamt: <span id="gesamt">0</span> / <span id="ziel">8</span></p>
    <div id="rollen-buttons"></div>
  </div>

  <button id="btn-start" disabled>‚ñ∂Ô∏è Spiel starten</button>
</div>

<!-- ROLLEN ANZEIGEN -->
<div id="phase-rollen" class="phase">
  <div class="section">
    <h2 id="rolle-titel">Deine Rolle</h2>
    <div id="rolle-inhalt"></div>
    <button id="btn-rolle-weiter" class="hidden">Weiter</button>
  </div>
</div>

<!-- SPIEL (NACHT/TAG) -->
<div id="phase-spiel" class="phase">
  <div class="section">
    <h2 id="spiel-titel">Nacht 1</h2>
    <div id="spiel-inhalt"></div>
    <button id="btn-spiel-weiter" class="hidden">Weiter</button>
  </div>

  <div class="section">
    <h3>Lebende Spieler</h3>
    <div id="lebende-liste"></div>
  </div>
</div>

<script>
// ===== ROLLEN DEFINITION =====
const ROLLEN_CONFIG = {
  werwolf: { name: "Einfache Werw√∂lfe", team: "boese", size: 1 },
  urwolf: { name: "Der Urwolf", team: "boese", size: 1 },
  grosser_wolf: { name: "Der gro√üe, b√∂se Wolf", team: "boese", size: 1 },
  dorfbewohner: { name: "Einfache Dorfbewohner", team: "gut", size: 1 },
  amor: { name: "Amor", team: "neutral_amor", size: 1 },
  seherin: { name: "Die Seherin", team: "gut", size: 1 },
  schwestern: { name: "Die zwei Schwestern", team: "gut", size: 2 },
  maedchen: { name: "Das kleine M√§dchen", team: "gut", size: 1 },
  fuchs: { name: "Der Fuchs", team: "gut", size: 1 },
  ritter: { name: "Der Ritter der rostigen Klinge", team: "gut", size: 1 },
  alte: { name: "Der Alte", team: "gut", size: 1 },
  hexe: { name: "Die Hexe", team: "gut", size: 1 },
  baer: { name: "Der B√§renf√ºhrer", team: "gut", size: 1 },
  jaeger: { name: "Der J√§ger", team: "gut", size: 1 },
  wilde_kind: { name: "Das wilde Kind", team: "gut_zuerst", size: 1 },
  wolfshund: { name: "Der Wolfshund", team: "neutral_waehlt", size: 1 },
  weisser_wolf: { name: "Der wei√üe Werwolf", team: "boese_weiss", size: 1 },
  floete: { name: "Der Fl√∂tenspieler", team: "neutral_floete", size: 1 },
  engel: { name: "Der Engel", team: "gut", size: 1 }
};

// ===== SPIELZUSTAND =====
let state = {
  spielerzahl: 8,
  spieler: [],
  rollenVerteilung: {},
  aktuelleNacht: 1,
  phase: 'setup', // setup, rollen, nacht, tag
  liebespaar: null,
  hexeHeil: true,
  hexeGift: true,
  wildeKindMentor: null,
  wolfshundTeam: null,
  werwolfOpfer: null,
  grosserWolfOpfer: null,
  maedchenEntdeckt: false,
  seherinZiel: null,
  fuchsGruppe: [],
  floeteZiel: []
};

// ===== SETUP LOGIK =====
document.getElementById('spielerzahl').addEventListener('input', updateNamenFelder);
function updateNamenFelder() {
  const n = Math.max(6, Math.min(48, parseInt(this.value) || 8));
  this.value = n;
  state.spielerzahl = n;
  document.getElementById('ziel').textContent = n;

  let html = '';
  for (let i = 1; i <= n; i++) {
    html += `<div class="spieler-item"><label>Spieler ${i}:</label> <input type="text" id="name-${i}" value="Spieler ${i}"></div>`;
  }
  document.getElementById('namen-liste').innerHTML = html;
  updateGesamtAnzahl();
}

// Rollen-Buttons
const rollenContainer = document.getElementById('rollen-buttons');
for (const key in ROLLEN_CONFIG) {
  const config = ROLLEN_CONFIG[key];
  const btn = document.createElement('div');
  btn.className = 'rolle-btn';
  btn.dataset.rolle = key;
  btn.textContent = `${config.name} (0)`;
  btn.onclick = () => {
    state.rollenVerteilung[key] = (state.rollenVerteilung[key] || 0) + 1;
    renderRollenButtons();
    updateGesamtAnzahl();
  };
  rollenContainer.appendChild(btn);
}

function renderRollenButtons() {
  for (const key in ROLLEN_CONFIG) {
    const btn = document.querySelector(`[data-rolle="${key}"]`);
    const count = state.rollenVerteilung[key] || 0;
    btn.textContent = `${ROLLEN_CONFIG[key].name} (${count})`;
    btn.classList.toggle('active', count > 0);
  }
}

function updateGesamtAnzahl() {
  let total = 0;
  for (const key in state.rollenVerteilung) {
    const count = state.rollenVerteilung[key] || 0;
    total += count * ROLLEN_CONFIG[key].size;
  }
  document.getElementById('gesamt').textContent = total;
  document.getElementById('btn-start').disabled = (total !== state.spielerzahl);
}

// Start
document.getElementById('btn-start').addEventListener('click', starteSpiel);

function starteSpiel() {
  // Spieler erstellen
  state.spieler = [];
  let playerId = 1;
  for (let i = 1; i <= state.spielerzahl; i++) {
    const name = document.getElementById(`name-${i}`)?.value || `Spieler ${i}`;
    state.spieler.push({ id: playerId++, name, lebend: true, rolle: null, rolleName: '' });
  }

  // Rollen zuweisen
  let idx = 0;
  for (const rolleKey in state.rollenVerteilung) {
    const count = state.rollenVerteilung[rolleKey] || 0;
    for (let i = 0; i < count; i++) {
      if (ROLLEN_CONFIG[rolleKey].size === 2) {
        if (idx < state.spieler.length) {
          state.spieler[idx].rolle = rolleKey;
          state.spieler[idx].rolleName = ROLLEN_CONFIG[rolleKey].name;
          idx++;
        }
        if (idx < state.spieler.length) {
          state.spieler[idx].rolle = rolleKey;
          state.spieler[idx].rolleName = ROLLEN_CONFIG[rolleKey].name;
          idx++;
        }
      } else {
        if (idx < state.spieler.length) {
          state.spieler[idx].rolle = rolleKey;
          state.spieler[idx].rolleName = ROLLEN_CONFIG[rolleKey].name;
          idx++;
        }
      }
    }
  }

  // Zur Rollen-Phase wechseln
  document.getElementById('phase-setup').classList.remove('active');
  document.getElementById('phase-rollen').classList.add('active');
  state.phase = 'rollen';
  zeigeNaechsteRolle(0);
}

// ===== ROLLEN VERTEILEN =====
function zeigeNaechsteRolle(index) {
  if (index >= state.spieler.length) {
    // Alle Rollen verteilt ‚Üí Nacht 1
    document.getElementById('phase-rollen').classList.remove('active');
    document.getElementById('phase-spiel').classList.add('active');
    state.phase = 'nacht';
    starteNachtPhase();
    return;
  }

  const spieler = state.spieler[index];
  document.getElementById('rolle-titel').textContent = spieler.name;
  document.getElementById('rolle-inhalt').innerHTML = `
    <p>Dr√ºcke auf ‚ÄûAnzeigen‚Äú, um deine Rolle zu sehen.</p>
    <button id="btn-rolle-anzeigen">anzeigen</button>
    <div id="rolle-text" class="hidden info"></div>
  `;

  document.getElementById('btn-rolle-weiter').classList.add('hidden');

  document.getElementById('btn-rolle-anzeigen').onclick = () => {
    document.getElementById('rolle-text').textContent = `Du bist: ${spieler.rolleName}`;
    document.getElementById('rolle-text').classList.remove('hidden');
    document.getElementById('btn-rolle-weiter').classList.remove('hidden');
    document.getElementById('btn-rolle-weiter').onclick = () => zeigeNaechsteRolle(index + 1);
  };
}

// ===== NACHTPHASENLOGIK =====
function starteNachtPhase() {
  document.getElementById('spiel-titel').textContent = `Nacht ${state.aktuelleNacht}`;
  let html = `<p><strong>Nacht ${state.aktuelleNacht}</strong></p>`;

  // === AMOR (nur Nacht 1) ===
  if (state.aktuelleNacht === 1) {
    const amor = state.spieler.find(p => p.lebend && p.rolle === 'amor');
    if (amor) {
      html += `<h3>Amor</h3><p>W√§hle zwei Spieler f√ºr das Liebespaar:</p>`;
      html += `<select id="amor-1">`;
      state.spieler.forEach(p => {
        html += `<option value="${p.id}">${p.name}</option>`;
      });
      html += `</select> und <select id="amor-2">`;
      state.spieler.forEach(p => {
        html += `<option value="${p.id}">${p.name}</option>`;
      });
      html += `</select>`;
    }
  }

  // === WERW√ñLFE ===
  const werwoelfe = state.spieler.filter(p => p.lebend && ['werwolf', 'urwolf', 'grosser_wolf'].includes(p.rolle));
  if (werwoelfe.length > 0) {
    html += `<h3>Werw√∂lfe</h3><p>Wen t√∂tet ihr?</p>`;
    html += `<select id="werwolf-opfer">`;
    state.spieler.filter(p => p.lebend).forEach(p => {
      html += `<option value="${p.id}">${p.name}</option>`;
    });
    html += `</select>`;
  }

  // === GROSSER WOLF (jede 2. Nacht) ===
  if (state.aktuelleNacht % 2 === 0) {
    const grosserWolf = state.spieler.find(p => p.lebend && p.rolle === 'grosser_wolf');
    if (grosserWolf) {
      html += `<h3>Gro√üer b√∂ser Wolf</h3><p>Zweites Opfer dieser Nacht:</p>`;
      html += `<select id="grosser-opfer">`;
      state.spieler.filter(p => p.lebend).forEach(p => {
        html += `<option value="${p.id}">${p.name}</option>`;
      });
      html += `</select>`;
    }
  }

  // === HEXE ===
  const hexe = state.spieler.find(p => p.lebend && p.rolle === 'hexe');
  if (hexe && (state.hexeHeil || state.hexeGift)) {
    html += `<h3>Die Hexe</h3>`;
    if (state.hexeHeil) {
      html += `<label><input type="checkbox" id="hexe-heilen"> Opfer der Werw√∂lfe heilen</label><br>`;
    }
    if (state.hexeGift) {
      html += `Gifttrank: <select id="hexe-gift">`;
      state.spieler.filter(p => p.lebend).forEach(p => {
        html += `<option value="${p.id}">${p.name}</option>`;
      });
      html += `</select>`;
    }
  }

  // === SEHERIN ===
  const seherin = state.spieler.find(p => p.lebend && p.rolle === 'seherin');
  if (seherin) {
    html += `<h3>Die Seherin</h3><p>Wen willst du aussp√§hen?</p>`;
    html += `<select id="seherin-ziel">`;
    state.spieler.filter(p => p.lebend).forEach(p => {
      html += `<option value="${p.id}">${p.name}</option>`;
    });
    html += `</select>`;
  }

  // === KLEINES M√ÑDCHEN ===
  const maedchen = state.spieler.find(p => p.lebend && p.rolle === 'maedchen');
  if (maedchen) {
    html += `<h3>Das kleine M√§dchen</h3>`;
    html += `<p>Nachdem die Werw√∂lfe eingeschlafen sind: Wurde es entdeckt?</p>`;
    html += `<label><input type="radio" name="maedchen-entdeckt" value="nein" checked> Nein</label> `;
    html += `<label><input type="radio" name="maedchen-entdeckt" value="ja"> Ja</label>`;
  }

  document.getElementById('spiel-inhalt').innerHTML = html;
  document.getElementById('btn-spiel-weiter').classList.remove('hidden');
  document.getElementById('btn-spiel-weiter').onclick = verarbeiteNachtAktionen;
  renderLebendeSpieler();
}

function verarbeiteNachtAktionen() {
  // Amor
  if (state.aktuelleNacht === 1) {
    const a1 = document.getElementById('amor-1')?.value;
    const a2 = document.getElementById('amor-2')?.value;
    if (a1 && a2 && a1 !== a2) {
      state.liebespaar = [parseInt(a1), parseInt(a2)];
    }
  }

  // Werwolf-Opfer
  const wwOpfer = document.getElementById('werwolf-opfer')?.value;
  if (wwOpfer) state.werwolfOpfer = parseInt(wwOpfer);

  // Gro√üer Wolf
  if (state.aktuelleNacht % 2 === 0) {
    const gwOpfer = document.getElementById('grosser-opfer')?.value;
    if (gwOpfer) state.grosserWolfOpfer = parseInt(gwOpfer);
  }

  // Hexe
  if (document.getElementById('hexe-heilen')?.checked) {
    state.hexeHeil = false;
    state.werwolfOpfer = null; // gerettet
  }
  const giftOpfer = document.getElementById('hexe-gift')?.value;
  if (giftOpfer && state.hexeGift) {
    state.hexeGift = false;
    const p = state.spieler.find(x => x.id === parseInt(giftOpfer));
    if (p) p.lebend = false;
  }

  // Seherin
  const seherinZiel = document.getElementById('seherin-ziel')?.value;
  if (seherinZiel) {
    const ziel = state.spieler.find(p => p.id === parseInt(seherinZiel));
    if (ziel) {
      alert(`Die Seherin sieht: ${ziel.rolleName}`);
    }
  }

  // Kleines M√§dchen
  state.maedchenEntdeckt = document.querySelector('input[name="maedchen-entdeckt"]:checked')?.value === 'ja';
  if (state.maedchenEntdeckt) {
    const m = state.spieler.find(p => p.rolle === 'maedchen');
    if (m) m.lebend = false;
  }

  // Opfer anwenden (wenn nicht gerettet)
  if (state.werwolfOpfer) {
    const opfer = state.spieler.find(p => p.id === state.werwolfOpfer);
    if (opfer) opfer.lebend = false;
  }
  if (state.grosserWolfOpfer) {
    const opfer = state.spieler.find(p => p.id === state.grosserWolfOpfer);
    if (opfer) opfer.lebend = false;
  }

  // Liebespaar-Tode
  if (state.liebespaar) {
    const [a, b] = state.liebespaar;
    const pA = state.spieler.find(p => p.id === a);
    const pB = state.spieler.find(p => p.id === b);
    if (pA && !pA.lebend && pB && pB.lebend) {
      pB.lebend = false;
    } else if (pB && !pB.lebend && pA && pA.lebend) {
      pA.lebend = false;
    }
  }

  // Weiter zur Tagphase
  starteTagPhase();
}

function starteTagPhase() {
  document.getElementById('spiel-titel').textContent = `Tag ${state.aktuelleNacht}`;
  const tote = state.spieler.filter(p => !p.lebend);
  let html = `<h3>Tote der Nacht</h3>`;
  if (tote.length > 0) {
    html += `<p>${tote.map(p => p.name).join(', ')}</p>`;
  } else {
    html += `<p>Keine Toten.</p>`;
  }

  html += `<h3>Hinrichtung</h3>`;
  html += `<p>Wen beschuldigt das Dorf?</p>`;
  html += `<select id="hinrichtung">`;
  state.spieler.filter(p => p.lebend).forEach(p => {
    html += `<option value="${p.id}">${p.name}</option>`;
  });
  html += `</select>`;
  html += `<button onclick="fuehreHinrichtungAus()">Hinrichten</button>`;

  document.getElementById('spiel-inhalt').innerHTML = html;
  document.getElementById('btn-spiel-weiter').classList.add('hidden');
  renderLebendeSpieler();
}

function fuehreHinrichtungAus() {
  const id = parseInt(document.getElementById('hinrichtung').value);
  const opfer = state.spieler.find(p => p.id === id);
  if (opfer) opfer.lebend = false;

  // Liebespaar pr√ºfen
  if (state.liebespaar) {
    const [a, b] = state.liebespaar;
    const pA = state.spieler.find(p => p.id === a);
    const pB = state.spieler.find(p => p.id === b);
    if (pA && !pA.lebend && pB && pB.lebend) {
      pB.lebend = false;
    } else if (pB && !pB.lebend && pA && pA.lebend) {
      pA.lebend = false;
    }
  }

  // Sieg pr√ºfen
  const boese = state.spieler.filter(p => 
    p.lebend && 
    ['werwolf', 'urwolf', 'grosser_wolf', 'weisser_wolf'].includes(p.rolle)
  );
  const gut = state.spieler.filter(p => 
    p.lebend && 
    !['werwolf', 'urwolf', 'grosser_wolf', 'weisser_wolf'].includes(p.rolle)
  );

  if (boese.length === 0) {
    document.getElementById('spiel-inhalt').innerHTML = `<h2>üéâ Das Dorf gewinnt!</h2>`;
  } else if (boese.length >= gut.length) {
    document.getElementById('spiel-inhalt').innerHTML = `<h2>üåë Die Werw√∂lfe gewinnen!</h2>`;
  } else {
    state.aktuelleNacht++;
    starteNachtPhase();
  }
  renderLebendeSpieler();
}

function renderLebendeSpieler() {
  const container = document.getElementById('lebende-liste');
  container.innerHTML = '';
  state.spieler.filter(p => p.lebend).forEach(p => {
    const div = document.createElement('div');
    div.textContent = p.name;
    container.appendChild(div);
  });
}

// Init
updateNamenFelder();
</script>

</body>
</html>
